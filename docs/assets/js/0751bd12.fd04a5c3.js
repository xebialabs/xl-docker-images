"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[801],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(h,l(l({ref:t},p),{},{components:n})):r.createElement(h,l({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var c=2;c<o;c++)l[c]=n[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},871:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),l=["components"],i={sidebar_position:2},s="Upgrade XL Release active-active cluster setup with docker compose",c={unversionedId:"manual/xl-release-ha/upgrade-multi-node-deployment",id:"manual/xl-release-ha/upgrade-multi-node-deployment",isDocsHomePage:!1,title:"Upgrade XL Release active-active cluster setup with docker compose",description:"Steps",source:"@site/docs/manual/xl-release-ha/upgrade-multi-node-deployment.md",sourceDirName:"manual/xl-release-ha",slug:"/manual/xl-release-ha/upgrade-multi-node-deployment",permalink:"/xl-docker-images/docs/manual/xl-release-ha/upgrade-multi-node-deployment",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"XL Release active-active cluster setup with docker compose",permalink:"/xl-docker-images/docs/manual/xl-release-ha/README"},next:{title:"Using development version images with minikube",permalink:"/xl-docker-images/docs/manual/k8s_development_versions"}},p=[{value:"Steps",id:"steps",children:[],level:3}],u={toc:p};function d(e){var t=e.components,n=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"upgrade-xl-release-active-active-cluster-setup-with-docker-compose"},"Upgrade XL Release active-active cluster setup with docker compose"),(0,o.kt)("h3",{id:"steps"},"Steps"),(0,o.kt)("p",null,"Follow these steps to Upgrade XL Release active-active cluster setup:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Make sure to read our docs for upgrade and release notes for each version you want to upgrade to.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Stop the current running instances of the docker containers which have the old version that need to be upgraded. You do not need to stop the load balancer, mq and database containers. See the example below:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"}," # Shutdown deployments\n docker-compose -f docker-compose-xlr-ha.yaml stop xl-release-master  \n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Update the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose-xlr-ha.yaml")," file as shown"))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Update the image with new tag which represent version you want to upgrade to for both master and worker, for example,",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"}," xl-release-master:\n   image: xebialabs/xl-release:9.5.2\n"))),(0,o.kt)("li",{parentName:"ul"},"Specify your DB connection details to point to the old DB, for example using environment variables such as ",(0,o.kt)("inlineCode",{parentName:"li"},"XL_DB_URL")),(0,o.kt)("li",{parentName:"ul"},'Include all volumes already being used with old docker images. In case of "conf" volume, make sure also to update any configurations required by the new version "check release notes", before mounting it to new version of the container.'),(0,o.kt)("li",{parentName:"ul"},"Update the environment variables to include ",(0,o.kt)("inlineCode",{parentName:"li"},"FORCE_UPGRADE")," see below,",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"}," environment:\n       - FORCE_UPGRADE=true\n")))),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"You can use the provided ",(0,o.kt)("inlineCode",{parentName:"li"},"run.sh")," to bring up the setup or do it manually by following the steps shown below. Update the passwords to represent Passwords used in previous version.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"# Set passwords\nexport XLR_ADMIN_PASS=admin\nexport POSTGRES_PASS=admin\n\n# upgrade master nodes,\ndocker-compose -f docker-compose-xlr-ha.yaml up --scale xl-release-master=2 -d\n\n# Print out the status\ndocker-compose -f docker-compose-xlr-ha.yaml ps\n")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"You can view the logs of individual containers using the ",(0,o.kt)("inlineCode",{parentName:"li"},"docker logs <container_name> -f")," command."),(0,o.kt)("li",{parentName:"ol"},"You can access the XL Release UI at http://localhost:8081")))}d.isMDXComponent=!0}}]);