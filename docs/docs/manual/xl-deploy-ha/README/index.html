<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<title data-react-helmet="true">XL Deploy active-active cluster setup with docker compose | DevOps Platform Docker Images</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io/xl-docker-images/docs/manual/xl-deploy-ha/README"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="XL Deploy active-active cluster setup with docker compose | DevOps Platform Docker Images"><meta data-react-helmet="true" name="description" content="The production setup for XL Deploy as mentioned here can be done using Docker compose as below."><meta data-react-helmet="true" property="og:description" content="The production setup for XL Deploy as mentioned here can be done using Docker compose as below."><link data-react-helmet="true" rel="shortcut icon" href="/xl-docker-images/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io/xl-docker-images/docs/manual/xl-deploy-ha/README"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-docker-images/docs/manual/xl-deploy-ha/README" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-docker-images/docs/manual/xl-deploy-ha/README" hreflang="x-default"><link rel="stylesheet" href="/xl-docker-images/assets/css/styles.22a8eaea.css">
<link rel="preload" href="/xl-docker-images/assets/js/runtime~main.20d59bf3.js" as="script">
<link rel="preload" href="/xl-docker-images/assets/js/main.79b8a614.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/xl-docker-images/"><div class="navbar__logo"><img src="/xl-docker-images/img/digital_ai_deploy.svg" alt="DevOps Platform Docker Images Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/xl-docker-images/img/digital_ai_deploy.svg" alt="DevOps Platform Docker Images Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">DevOps Platform Docker Images</b></a><a class="navbar__item navbar__link navbar__link--active" href="/xl-docker-images/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xebialabs/xl-docker-images" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-docker-images/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-docker-images/docs/prerequisites">Prerequisites</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-docker-images/docs/generating">Generating the Dockerfiles for a new version of the DevOps Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-docker-images/docs/building">Building Docker images from generated Dockerfiles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Configuration</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-docker-images/docs/manual/environment-variables">Environment variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-docker-images/docs/manual/volumes">Working with Volumes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-docker-images/docs/manual/customisation">Dockerfile customization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-docker-images/docs/manual/single-node-deployment">Single node deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-docker-images/docs/manual/upgrade-single-node-deployment">Upgrade Single node deployment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Deploy HA</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/xl-docker-images/docs/manual/xl-deploy-ha/README">XL Deploy active-active cluster setup with docker compose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-docker-images/docs/manual/xl-deploy-ha/upgrade-multi-node-deployment">Upgrade XL Deploy active-active cluster setup with docker compose</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Release HA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xl-docker-images/docs/manual/k8s_development_versions">Using development version images with minikube</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>XL Deploy active-active cluster setup with docker compose</h1></header><p>The production setup for XL Deploy as mentioned <a href="https://docs.xebialabs.com/v.10.3/deploy/how-to/set-up-xl-deploy-in-production/" target="_blank" rel="noopener noreferrer">here</a> can be done using Docker compose as below.</p><p>This article provides a sample approach you can follow to setup the database and other infrastructure of your choice.</p><p><strong>Note 1</strong>: For production deployments it is advised that you use Kubernetes to orchestrate the deployment of the applications. Docker compose is not ideal for production setup. Proceed at your own risk. Use the <code>xl up</code> command from the official XebiaLabs CLI to install XebiaLabs products using Kubernetes, for more details see <a href="https://docs.xebialabs.com/v.9.5/xl-deploy/concept/xl-up-manage-deployments" target="_blank" rel="noopener noreferrer">Manage Deployments with XL Up</a></p><p><strong>Note 2</strong>: For HA setup to work, you need to mount a license file or provide an environment variable <code>XL_LICENSE</code> with a license text converted to base64 for the XL Deploy instances</p><p><strong>Note 3</strong>: The folders you mount needs to be owned by user 10001, for example, you can run <code>sudo chown -R 10001 xl-deploy-master</code> if you are going to mount directories under <code>$PWD/xl-deploy-master</code> folder.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="setup">setup<a aria-hidden="true" class="hash-link" href="#setup" title="Direct link to heading">â€‹</a></h3><p>The setup includes</p><ul><li>A load balancer with HaProxy</li><li>RabbitMQ single node setup</li><li>PostgreSQL database single node setup</li><li>XL Deploy master nodes</li><li>XL Deploy worker nodes</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="limitations">Limitations:<a aria-hidden="true" class="hash-link" href="#limitations" title="Direct link to heading">â€‹</a></h3><ul><li>You can have only 2 master nodes</li><li>The database setup is for demo purposes, use your own setup or use external database</li><li>The MQ setup is for demo purposes, use your own setup or use external MQ</li><li>The HAproxy setup is for demo purposes, use your own setup</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="steps">Steps<a aria-hidden="true" class="hash-link" href="#steps" title="Direct link to heading">â€‹</a></h3><p>Follow the below steps to deploy the sample</p><ol><li>Download the <code>docker-compose-xld-ha.yaml</code> and <code>docker-compose-xld-ha-workers.yaml</code> files here</li><li>You can use the provided <code>run.sh</code> to bring up the setup or do it manually with below steps, change the passwords as required in either case.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Set passwords</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">XLD_ADMIN_PASS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_PASS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_PASS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create docker network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker network create xld-network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deploy master nodes, load balancer, mq and database. You should not change the number of master nodes here, it must be 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f docker-compose-xld-ha.yaml up --scale xl-deploy-master</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get the IP of master nodes, change the container names if you are not inside a folder named &quot;xl-deploy-ha&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">XLD_MASTER_1</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">docker inspect -f </span><span class="token variable string" style="color:#e3116c">&#x27;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#x27;</span><span class="token variable" style="color:#36acaa"> xl-deploy-ha_xl-deploy-master_1</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">XLD_MASTER_2</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">docker inspect -f </span><span class="token variable string" style="color:#e3116c">&#x27;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#x27;</span><span class="token variable" style="color:#36acaa"> xl-deploy-ha_xl-deploy-master_2</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Deploy the worker nodes, you can change the number of nodes here if you wish</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f docker-compose-xld-ha-workers.yaml up --scale xl-deploy-worker</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Print out the status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f docker-compose-xld-ha.yaml -f docker-compose-xld-ha-workers.yaml </span><span class="token function" style="color:#d73a49">ps</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li>You can view the logs of individual containers using the <code>docker logs &lt;container_name&gt; -f</code> command.</li><li>You can access XL Deploy UI at http://localhost:8080</li><li>To shutdown the setup you can run below</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Shutdown deployments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f docker-compose-xld-ha.yaml -f docker-compose-xld-ha-workers.yaml down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Remove network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker network </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> xld-network</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="steps-to-use-digitalai-deploy-task-engine-as-a-worker">Steps to use Digital.ai Deploy Task Engine as a worker<a aria-hidden="true" class="hash-link" href="#steps-to-use-digitalai-deploy-task-engine-as-a-worker" title="Direct link to heading">â€‹</a></h3><p>From 10.4 we split Deploy Task Engine to a separate distribution. So that running the task has only the code which
is required for that, not the full version of Deploy. It has a less footprint what can give a great benefit in saving VM RAM.</p><p>Use shell scripts <code>slim-up.sh</code> to bring the cluster up and <code>slim-down.sh</code> to shut it down.
The difference in the configuration is quite subtle, <code>docker-compose-xld-ha-slim-workers.yaml</code> points to another image
and has a bit different command. <code>worker</code> argument is no more required. </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="for-upgrade-procedures-please-check-this-upgrade-multi-node-deployment">For Upgrade procedures please check this <a href="/xl-docker-images/docs/manual/xl-deploy-ha/upgrade-multi-node-deployment">upgrade multi node deployment</a><a aria-hidden="true" class="hash-link" href="#for-upgrade-procedures-please-check-this-upgrade-multi-node-deployment" title="Direct link to heading">â€‹</a></h4></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/xl-docker-images/docs/manual/upgrade-single-node-deployment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Upgrade Single node deployment</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/xl-docker-images/docs/manual/xl-deploy-ha/upgrade-multi-node-deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrade XL Deploy active-active cluster setup with docker compose<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup" class="table-of-contents__link toc-highlight">setup</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations:</a></li><li><a href="#steps" class="table-of-contents__link toc-highlight">Steps</a></li><li><a href="#steps-to-use-digitalai-deploy-task-engine-as-a-worker" class="table-of-contents__link toc-highlight">Steps to use Digital.ai Deploy Task Engine as a worker</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/xl-docker-images/docs/intro">Tutorial</a></li><li class="footer__item"><a href="https://github.com/xebialabs/xl-docker-images" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 DevOps Platform Docker Images Digital.ai</div></div></div></footer></div>
<script src="/xl-docker-images/assets/js/runtime~main.20d59bf3.js"></script>
<script src="/xl-docker-images/assets/js/main.79b8a614.js"></script>
</body>
</html>